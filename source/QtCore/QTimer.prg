//
// Qt5xHb - Bindings libraries for Harbour/xHarbour and Qt Framework 5
//
// Copyright (c) 2026 Marcos Antonio Gambeta <marcosgambeta@outlook.com>
//

// DO NOT EDIT THIS FILE - the content was created using a source code generator

// clang-format off

#include <hbclass.ch>

#ifndef QT5XHB_NO_REQUESTS
#endif

CLASS QTimer INHERIT QObject

   METHOD new
   METHOD delete
   METHOD interval
   METHOD isActive
   METHOD isSingleShot
   METHOD setInterval
   METHOD setSingleShot
   METHOD timerId
   METHOD start
   METHOD stop
   METHOD singleShot

   METHOD onTimeout

   DESTRUCTOR destroyObject

ENDCLASS

PROCEDURE destroyObject() CLASS QTimer
   IF ::self_destruction
      ::delete()
   ENDIF
RETURN

// clang-format on

#pragma BEGINDUMP

#include <QtCore/Qt>

#ifndef __XHARBOUR__
#include <QtCore/QTimer>
#endif

#include "qt5xhb_common.hpp"
#include "qt5xhb_macros.hpp"
#include "qt5xhb_utils.hpp"
#include "qt5xhb_events.hpp"
#include "qt5xhb_signals.hpp"

#ifdef __XHARBOUR__
#include <QtCore/QTimer>
#endif

#define GET_PTR_FROM_SELF(p) auto p = qobject_cast<QTimer *>(Qt5xHb::getQObjectPointerFromSelfItem())

// QTimer(QObject *parent = nullptr)
HB_FUNC_STATIC(QTIMER_NEW)
{
  if (ISBETWEEN(0, 1) && ISQOBJECTORNIL(1)) {
    auto obj = new QTimer(OPQOBJECT(1, nullptr));
    Qt5xHb::returnNewObject(obj, false);
  } else {
    THROW_ERROR_3012();
  }
}

HB_FUNC_STATIC(QTIMER_DELETE)
{
  GET_PTR_FROM_SELF(obj);
  DELETE_QOBJECT(obj);
  RETURN_SELF();
}

// int interval() const
HB_FUNC_STATIC(QTIMER_INTERVAL)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(0)) {
#endif
      RINT(obj->interval());
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }
}

// bool isActive() const
HB_FUNC_STATIC(QTIMER_ISACTIVE)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(0)) {
#endif
      RBOOL(obj->isActive());
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }
}

// bool isSingleShot() const
HB_FUNC_STATIC(QTIMER_ISSINGLESHOT)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(0)) {
#endif
      RBOOL(obj->isSingleShot());
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }
}

// void setInterval(int msec)
HB_FUNC_STATIC(QTIMER_SETINTERVAL)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(1) && HB_ISNUM(1)) {
#endif
      obj->setInterval(PINT(1));
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }

  RETURN_SELF();
}

// void setSingleShot(bool singleShot)
HB_FUNC_STATIC(QTIMER_SETSINGLESHOT)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(1) && ISBOOL(1)) {
#endif
      obj->setSingleShot(PBOOL(1));
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }

  RETURN_SELF();
}

// int timerId() const
HB_FUNC_STATIC(QTIMER_TIMERID)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(0)) {
#endif
      RINT(obj->timerId());
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }
}

HB_FUNC_STATIC(QTIMER_START)
{
  if (ISNUMPAR(1) && HB_ISNUM(1)) {
    // void start(int msec)
    GET_PTR_FROM_SELF(obj);

    if (obj != nullptr) {
      obj->start(PINT(1));
    }

    RETURN_SELF();
  } else if (ISNUMPAR(0)) {
    // void start()
    GET_PTR_FROM_SELF(obj);

    if (obj != nullptr) {
      obj->start();
    }

    RETURN_SELF();
  } else {
    THROW_ERROR_3012();
  }
}

// void stop()
HB_FUNC_STATIC(QTIMER_STOP)
{
  GET_PTR_FROM_SELF(obj);

  if (obj != nullptr) {
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    if (ISNUMPAR(0)) {
#endif
      obj->stop();
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
    } else {
      THROW_ERROR_3012();
    }
#endif
  }

  RETURN_SELF();
}

// static void singleShot(int msec, QObject *receiver, const char *member)
HB_FUNC_STATIC(QTIMER_SINGLESHOT)
{
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
  if (ISNUMPAR(3) && HB_ISNUM(1) && ISQOBJECT(2) && HB_ISCHAR(3)) {
#endif
    QTimer::singleShot(PINT(1), PQOBJECT(2), PCONSTCHAR(3));
#ifndef QT5XHB_DONT_CHECK_PARAMETERS
  } else {
    THROW_ERROR_3012();
  }
#endif

  RETURN_SELF();
}

// void timeout()
HB_FUNC_STATIC(QTIMER_ONTIMEOUT)
{
  GET_PTR_FROM_SELF(sender);

  auto result = false;

  if (sender != nullptr) {
    auto indexOfSignal = sender->metaObject()->indexOfSignal("timeout()");
    auto indexOfCodeBlock = -1;

    if (ISNUMPAR(1) && ISBLOCKORSYMBOL(1)) {
      if (Qt5xHb::Signals_connection(sender, indexOfSignal, indexOfCodeBlock)) {
        auto connection = QObject::connect(sender, &QTimer::timeout, [sender, indexOfCodeBlock]() {
          auto cb = Qt5xHb::Signals_return_codeblock(indexOfCodeBlock);

          if (cb != nullptr) {
            auto pSender = Qt5xHb::Signals_return_qobject(sender, "QTIMER");
            hb_vmEvalBlockV(cb, 1, pSender);
            hb_itemRelease(pSender);
          }
        });
        Qt5xHb::Signals_store_connection(indexOfCodeBlock, connection);
        result = true;
      }
    } else if (ISNUMPAR(0)) {
      Qt5xHb::Signals_disconnection(sender, indexOfSignal);
      QObject::disconnect(Qt5xHb::Signals_get_connection(sender, indexOfSignal));
      result = true;
    } else {
      THROW_ERROR_3012();
    }
  }

  hb_retl(result);
}

#pragma ENDDUMP
